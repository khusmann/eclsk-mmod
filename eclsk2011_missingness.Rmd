---
title: "Measurement models for executive function"
author: "Kyle Husmann"
date: "March 25, 2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source('scripts/eclsk2011data.R')
```

```{r, fig.width=12}
df_long <- df_rawraw %>%
  mutate_if(is.numeric, neg_to_na) %>%
  filter(X1FIRKDG == 1) %>%
  filter(S1_ID == S2_ID) %>%
  filter(S1_ID == S4_ID) %>%
  gather(key, value, allOccasionsFor(c(four_level_measures, seven_level_measures))) %>%
  separate(key, c('occasion', 'meas'), sep=2, remove=F) %>%
  mutate(occasion = as.numeric(str_sub(occasion, 2))) %>%
  mutate(not_observed = ifelse(key %in% allOccasionsFor(four_level_measures), value == 5, value == 8))

# Show dist of vars
df_long %>%
  ggplot(aes(value)) +
  geom_histogram() +
  facet_grid(vars(occasion), vars(meas))

# Show missingness
df_long %>%
  group_by(meas, occasion) %>%
  summarize(
    num_na = sum(is.na(value)),
    num_not_observed = sum(not_observed, na.rm=T)) %>%
  gather(stat, value, -meas, -occasion) %>%
  ggplot(aes(x = occasion, y = value, fill=stat)) +
  geom_col() +
  facet_wrap(~ meas)
```