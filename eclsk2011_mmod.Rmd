---
title: "Measurement models for executive function"
author: "Kyle Husmann"
date: "March 25, 2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source('scripts/eclsk2011data.R')

mmod_results <- map(list.files('data/mmod', full.names=T), read_rds)
names(mmod_results) <- map(mmod_results, 'name')

mmod_fits <- tibble(
  map_chr(mmod_results, 'name'),
  # map_dbl(mmod_results, ')
)
```

```{r}
measures_theory <- list(
  ATL = c('TKEEPS', 'TSHOWS', 'TWORKS', 'TADAPTS', 'TFOLLOW', 'TPERSIS', 'TATTEN'),
  CBQ_A = c('TBEZDAC', 'TBNOFIN', 'TBGCCLR', 'TBGCBLD', 'TBEZDSL', 'TBABSBK'),
  CBQ_I = c('TBWTTSK', 'TBTRBST', 'TBFLWIN', 'TBSTNO') # Omitting: 'TBPLNAC', 'TBAPRRK'
# Parent Items
    # ATL_P = c('PWRKFIN', 'PSHWINT', 'PCONCEN', 'PCHORES', 'PLEARN', 'PCREATV'),
# Child assessment
    # DCCS = c('XCSBGSC')
    # NREV = c('XNRSSCR')
)
```

```{r}
mmod_theory <- mmodModel(measures_theory, 'theory', fiml=F)
mmod_theory_res <- mxRun(mmod_theory)
summary(mmod_theory_res)
```

```{r}
cfa_theory <- map(occasions, ~cfaModel(measures_theory, paste0('theorycfa', .), ., fiml=T))
names(cfa_theory) <- map(cfa_theory, 'name')
cfa_theory_res <- map(cfa_theory, mxRun)
map(cfa_theory_res, summary)
```